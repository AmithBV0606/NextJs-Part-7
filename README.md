# Next-Js by Codevolution : Part-7 (last part)

### Topics Covered :

- Authentication
- Clerk Setup
- Sign in and Sign out
- Profile Settings
- Conditional UI Rendering
- Protecting Routes
- Read Session and User Data
- Role Based Access Control
- Customizing Clerk Components

## Authentication

- Most apps revolve around users.

- When building for users, we need to consider three fundamental concepts :

    - **Identity** : Verifying who someone is, through authentication.
    - **Sessions** : Keep track of a user's logged-in state across requests.
    - **Access** : Controls what they can do.

- In developers term, we call these authentication, session management and authorization.

- With React single-page apps, you're only dealing with client-side code.

- With Next.js, you've got to protect your app from three different angles: client-side, server-side and API routes.

- When implementing authentication, you will typically want to :

    1. Let users sign up
    2. Give them a way to sign in
    3. Enable them to manage their account (password changes, email updates, etc.)
    4. Show or hide UI elements based on whether they're logged in
    5. Protect certain routes depending on authentication status
    6. Access session and user data when needed
    7. Set up role-based access control (admin, editor, viewer, and so on)
    8. Provide a way to sign out

## Clerk Setup

- Visit `https://clerk.com/` and create an account if you don't have already one.

- Create an application by entering the application name and the methods through which you want your users to login/signup through (GitHub, Google, Email, username, etc).

- After creating an application, choose the framework in which you are building the project on.

- In this case I've selected Next.js

### Steps to integrate Clerk with Next.js

1. Install `@clerk/nextjs` : Run the following command to install the SDK :

```bash
npm install @clerk/nextjs
```

2. **Set your Clerk API keys :** Add these keys to your `.env` or create the file if it doesn't exist. Retrieve these keys anytime from the API keys page.

<img src="./assets/Pic-1.png" />

3. **Update `middleware.ts` :**

- Update your middleware file, or create one at the root of your project, or the `src/ directory` if you're using a `src/ directory` structure.

- The clerkMiddleware helper enables authentication and is where you'll configure your protected routes.

```ts
import { clerkMiddleware } from "@clerk/nextjs/server";

export default clerkMiddleware();

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
};
```

4. **Add ClerkProvider to your app :**

- The `ClerkProvidercomponent` provides Clerk's authentication context to your app. It's recommended to wrap your entire app at the entry point with `ClerkProvider` to make authentication globally accessible.

- Copy and paste the following file into your layout.tsx file. This creates a header with Clerk's prebuilt components to allow users to sign in and out.

```tsx
import { type Metadata } from 'next'
import { ClerkProvider } from '@clerk/nextjs'
import { Geist, Geist_Mono } from 'next/font/google'
import './globals.css'

const geistSans = Geist({
  variable: '--font-geist-sans',
  subsets: ['latin'],
})

const geistMono = Geist_Mono({
  variable: '--font-geist-mono',
  subsets: ['latin'],
})

export const metadata: Metadata = {
  title: 'Clerk Next.js Quickstart',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
          {children}
        </body>
      </html>
    </ClerkProvider>
  )
}
```

5. **Create your first user :**

- Run your project. Then, visit your app's homepage at http://localhost:3000 and sign up to create your first user.

```bash
npm run dev
```